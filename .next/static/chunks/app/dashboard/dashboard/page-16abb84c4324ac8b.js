(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{8953:function(e,t,a){Promise.resolve().then(a.bind(a,3260))},3940:function(e,t,a){"use strict";a.d(t,{r:function(){return m}});var s=a(7437),r=a(2265),l=a(3246),n=a(3541),i=a(2595),o=a(1047),d=a(2451),c=a(407),u=a(9048);function m(e){let{onDateRangeChange:t}=e,[a,m]=(0,r.useState)(!1),[f,h]=(0,r.useState)({from:new Date,to:new Date(new Date().getFullYear(),11,31)});return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)(i.z,{onClick:()=>m(!a),variant:"outline",className:"bg-white w-[240px] justify-start text-left font-normal",children:[(0,s.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),(null==f?void 0:f.from)?f.to?(0,s.jsxs)(s.Fragment,{children:[(0,n.Z)(f.from,"d MMM",{locale:u.Z})," -"," ",(0,n.Z)(f.to,"d MMM, yyyy",{locale:u.Z})]}):(0,n.Z)(f.from,"d MMM, yyyy",{locale:u.Z}):(0,s.jsx)("span",{children:"Seleccionar fechas"})]}),a&&(0,s.jsxs)("div",{className:"absolute top-full mt-2 bg-white rounded-lg shadow-lg p-4 z-50",children:[(0,s.jsx)(l._W,{mode:"range",defaultMonth:null==f?void 0:f.from,selected:f,onSelect:e=>{h(e),t(e)},numberOfMonths:2,locale:u.Z,formatters:{formatCaption:e=>(0,n.Z)(e,"MMMM yyyy",{locale:u.Z}).replace(/^\w/,e=>e.toUpperCase()),formatWeekdayName:e=>(0,n.Z)(e,"EEEEEE",{locale:u.Z}).toUpperCase()},components:{IconLeft:e=>{let{...t}=e;return(0,s.jsx)(d.Z,{className:"h-4 w-4",...t})},IconRight:e=>{let{...t}=e;return(0,s.jsx)(c.Z,{className:"h-4 w-4",...t})}},modifiers:{range:f},modifiersStyles:{range_start:{color:"white",backgroundColor:"#3b82f6"},range_end:{color:"white",backgroundColor:"#3b82f6"},range_middle:{color:"#1e3a8a",backgroundColor:"#eff6ff"}}}),(0,s.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,s.jsx)(i.z,{className:"bg-white hover:bg-gray-50 border border-gray-200",onClick:()=>{let e={from:new Date,to:new Date(new Date().getFullYear(),11,31)};h(e),t(e)},children:"Reiniciar"}),(0,s.jsx)(i.z,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>m(!1),children:"Cerrar"})]})]})]})}a(8377)},4935:function(e,t,a){"use strict";a.d(t,{p:function(){return l}});var s=a(7437),r=a(5863);function l(){return(0,s.jsxs)("div",{className:"h-screen flex flex-col items-center justify-center",children:[(0,s.jsx)(r.Z,{className:"h-8 w-8 animate-spin text-blue-500"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Loading..."})]})}},5660:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(7437);function r(e){let{totalAdItems:t,availableSpaces:a,occupiedSpaces:r}=e;return(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Total Espacios"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:t})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Disponibles"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-green-600",children:a})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Ocupados"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-amber-600",children:r})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Utilizaci\xf3n"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-purple-600",children:[t?Math.round(r/t*100):0,"%"]})]})]})}},2443:function(e,t,a){"use strict";a.d(t,{p:function(){return i}});var s=a(7437),r=a(605),l=a(9376),n=a(4935);function i(e){let{children:t,allowedRoles:a}=e,{data:i,status:o}=(0,r.useSession)();return"loading"===o?(0,s.jsx)(n.p,{}):((null==i?void 0:i.user)&&a.includes(i.user.role)||(0,l.redirect)("/leasing"),(0,s.jsx)(s.Fragment,{children:t}))}},2595:function(e,t,a){"use strict";a.d(t,{z:function(){return n}});var s=a(7437),r=a(2265),l=a(4508);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("button",{className:(0,l.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",a),ref:t,...r})});n.displayName="Button"},1973:function(e,t,a){"use strict";a.d(t,{I:function(){return n}});var s=a(7437),r=a(2265),l=a(4508);let n=r.forwardRef((e,t)=>{let{className:a,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border bg-background px-3 py-2 text-sm",a),ref:t,...n})});n.displayName="Input"},967:function(e,t,a){"use strict";a.d(t,{Bw:function(){return m},Ph:function(){return d},Ql:function(){return f},i4:function(){return c},ki:function(){return u}});var s=a(7437),r=a(2265),l=a(2286),n=a(875),i=a(401),o=a(4508);let d=l.fC,c=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(l.xz,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...i,children:[r,(0,s.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})]})});c.displayName=l.xz.displayName;let u=l.B4,m=r.forwardRef((e,t)=>{let{className:a,children:r,position:n="popper",...i}=e;return(0,s.jsx)(l.h_,{children:(0,s.jsx)(l.VY,{ref:t,className:(0,o.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...i,children:(0,s.jsx)(l.l_,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r})})})});m.displayName=l.VY.displayName;let f=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(l.ck,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.wU,{children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(l.eT,{children:r})]})});f.displayName=l.ck.displayName},7081:function(e,t,a){"use strict";a.d(t,{J:function(){return i},z:function(){return o}});var s=a(7437),r=a(2265);let l=(0,r.createContext)(void 0),n={"Lease successfully created":"Solicitud creada exitosamente","Failed to create lease":"Error al crear la solicitud","Lease successfully revoked":"Solicitud revocada exitosamente","Failed to revoke lease":"Error al revocar la solicitud","Store updated successfully":"Tienda actualizada exitosamente","Failed to update store":"Error al actualizar la tienda","Media space updated":"Espacio publicitario actualizado","Failed to update media space":"Error al actualizar el espacio publicitario"};function i(e){let{children:t}=e,[a,i]=(0,r.useState)([]),o=a.filter(e=>!e.read).length;return(0,s.jsx)(l.Provider,{value:{notifications:a,addNotification:e=>{let t=n[e]||e,a={id:Date.now().toString(),message:t,timestamp:new Date,read:!1};i(e=>[a,...e])},markAsRead:e=>{i(t=>t.map(t=>t.id===e?{...t,read:!0}:t))},clearNotification:e=>{i(t=>t.filter(t=>t.id!==e))},unreadCount:o},children:t})}let o=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("useNotifications must be used within a NotificationProvider");return e}},3260:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var s=a(7437),r=a(2265),l=a(9376),n=a(7648),i=a(5660),o=a(2595),d=a(967),c=a(1973),u=a(3940),m=a(4935),f=a(2443),h=a(7081);function x(){let e=(0,l.useSearchParams)().get("mediaTypeId"),[t,a]=(0,r.useState)([]),[x,p]=(0,r.useState)("None"),[g,b]=(0,r.useState)(!0),[v,w]=(0,r.useState)([]),[j,y]=(0,r.useState)("all"),[N,S]=(0,r.useState)(""),[k,C]=(0,r.useState)({from:new Date,to:new Date(new Date().getFullYear(),11,31)}),[D,I]=(0,r.useState)(e||"all"),[Z,E]=(0,r.useState)([]),{addNotification:M}=(0,h.z)();(0,r.useEffect)(()=>{e&&I(e)},[e]),(0,r.useEffect)(()=>{(async()=>{try{b(!0);let e=await fetch("/api/stores");if(!e.ok)throw Error("Failed to fetch stores");let t=await e.json();if(t.error)throw Error(t.error);a(t)}catch(e){console.error("Error fetching stores:",e)}finally{b(!1)}})()},[]),(0,r.useEffect)(()=>{fetch("/api/brands").then(e=>e.json()).then(e=>w(e)).catch(e=>console.error("Failed to fetch brands:",e))},[]),(0,r.useEffect)(()=>{fetch("/api/media-item-types").then(e=>e.json()).then(e=>{E(e)}).catch(e=>console.error("Failed to fetch media items:",e))},[]);let z=e=>{p(e);let s=[...t];switch(e){case"Product":s.sort((e,t)=>{let a=e.mediaSpaces.length;return t.mediaSpaces.length-a});break;case"Available":s.sort((e,t)=>{let a=e.mediaSpaces.filter(e=>"available"===e.status).length;return t.mediaSpaces.filter(e=>"available"===e.status).length-a});break;case"In Use":s.sort((e,t)=>{let a=e.mediaSpaces.filter(e=>{var t;return null===(t=e.leases)||void 0===t?void 0:t.some(e=>"Completado"!==e.status&&new Date(e.endDate)>=new Date)}).length;return t.mediaSpaces.filter(e=>{var t;return null===(t=e.leases)||void 0===t?void 0:t.some(e=>"Completado"!==e.status&&new Date(e.endDate)>=new Date)}).length-a})}a(s)},T=Array.isArray(t)?t.filter(e=>{let t=e.name.toLowerCase().includes(N.toLowerCase())||e.location.toLowerCase().includes(N.toLowerCase()),a="all"===j||"1"===j&&(2===e.brandId||3===e.brandId)||e.brandId.toString()===j,s="all"===D||e.mediaSpaces.some(e=>e.mediaItem.mediaItemType&&e.mediaItem.mediaItemType.id===parseInt(D));return t&&a&&s}):[],U=(0,r.useMemo)(()=>T.map(e=>{let t="all"===D?e.mediaSpaces:e.mediaSpaces.filter(e=>e.mediaItem&&e.mediaItem.mediaItemType.id===parseInt(D)),a={total:t.length,inUse:t.filter(e=>{var t;return null===(t=e.leases)||void 0===t?void 0:t.some(e=>{if(!(null==k?void 0:k.from)||!(null==k?void 0:k.to))return"Completado"!==e.status;let t=new Date(e.startDate),a=new Date(e.endDate);return"Completado"!==e.status&&t<=k.to&&a>=k.from})}).length,available:0};return a.available=a.total-a.inUse,{...e,stats:a,filteredSpaces:t}}),[T,D,k]),A=(0,r.useMemo)(()=>{let e=U.reduce((e,t)=>({total:e.total+t.stats.total,inUse:e.inUse+t.stats.inUse,available:e.available+t.stats.available}),{total:0,inUse:0,available:0});return{totalAdItems:e.total,availableSpaces:e.available,occupiedSpaces:e.inUse}},[U]);return((0,r.useMemo)(()=>{if(!t)return[];let e=[...t];switch(x){case"product":return e.sort((e,t)=>e.name.localeCompare(t.name));case"available":return e.sort((e,t)=>{let a=e.mediaSpaces.filter(e=>"available"===e.status).length;return t.mediaSpaces.filter(e=>"available"===e.status).length-a});case"inUse":return e.sort((e,t)=>{let a=e.mediaSpaces.filter(e=>{var t;return null===(t=e.leases)||void 0===t?void 0:t.some(e=>"Completado"!==e.status)}).length;return t.mediaSpaces.filter(e=>{var t;return null===(t=e.leases)||void 0===t?void 0:t.some(e=>"Completado"!==e.status)}).length-a});default:return e}},[t,x]),g)?(0,s.jsx)(m.p,{}):(0,s.jsx)(f.p,{allowedRoles:["ADMIN","ASSOCIATE"],children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(i.Z,{totalAdItems:A.totalAdItems,availableSpaces:A.availableSpaces,occupiedSpaces:A.occupiedSpaces}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Tiendas"}),(0,s.jsxs)("div",{className:"flex gap-3 bg-white p-2 rounded-lg shadow-md",children:[(0,s.jsx)(o.z,{onClick:()=>z("Product"),className:"px-4 py-2 rounded-md transition-all ".concat("Product"===x?"bg-blue-500 text-white shadow-sm":"bg-white text-gray-700 hover:bg-gray-50"),children:"Ordenar por Producto"}),(0,s.jsx)(o.z,{onClick:()=>z("Available"),className:"px-4 py-2 rounded-md transition-all ".concat("Available"===x?"bg-blue-500 text-white shadow-sm":"bg-white text-gray-700 hover:bg-gray-50"),children:"Ordenar por Disponibilidad"}),(0,s.jsx)(o.z,{onClick:()=>z("In Use"),className:"px-4 py-2 rounded-md transition-all ".concat("In Use"===x?"bg-blue-500 text-white shadow-sm":"bg-white text-gray-700 hover:bg-gray-50"),children:"Ordenar por Solicitudes"})]})]}),(0,s.jsxs)("div",{className:"flex gap-4 mb-6 items-center",children:[(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsx)(u.r,{onDateRangeChange:C})}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(c.I,{placeholder:"Buscar tiendas...",value:N,onChange:e=>S(e.target.value),className:"w-full"})}),(0,s.jsxs)("div",{className:"flex gap-2 flex-none",children:[(0,s.jsxs)(d.Ph,{value:D,onValueChange:I,children:[(0,s.jsx)(d.i4,{className:"w-[200px] bg-white",children:(0,s.jsx)(d.ki,{placeholder:"Todos los Tipos de Medios"})}),(0,s.jsxs)(d.Bw,{className:"max-h-[300px] overflow-y-auto bg-white",children:[(0,s.jsx)(d.Ql,{value:"all",children:"Todos los Tipos"}),Z.map(e=>(0,s.jsx)(d.Ql,{value:e.id.toString(),className:"hover:bg-gray-50",children:e.name},e.id))]})]}),(0,s.jsxs)(d.Ph,{value:j,onValueChange:y,children:[(0,s.jsx)(d.i4,{className:"w-[180px] bg-white",children:(0,s.jsx)(d.ki,{placeholder:"Todas las Marcas"})}),(0,s.jsxs)(d.Bw,{className:"bg-white",children:[(0,s.jsx)(d.Ql,{value:"all",children:"Todas las Marcas"}),v.map(e=>(0,s.jsx)(d.Ql,{value:e.id.toString(),children:e.name},e.id))]})]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:U.map(e=>(0,s.jsx)(n.default,{href:"/dashboard/store/".concat(e.id),className:"block",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-200 p-4",children:[(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 truncate",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.location})]}),(0,s.jsxs)("div",{className:"text-sm space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,s.jsx)("span",{className:"font-medium",children:e.stats.total})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-green-600",children:"Disponibles:"}),(0,s.jsx)("span",{className:"font-medium",children:e.stats.available})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-amber-600",children:"Ocupados:"}),(0,s.jsx)("span",{className:"font-medium",children:e.stats.inUse})]})]})]})},e.id))})]})]})})}},4508:function(e,t,a){"use strict";a.d(t,{cn:function(){return l}});var s=a(1994),r=a(3335);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}},1047:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},2451:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},407:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])}},function(e){e.O(0,[604,554,605,541,992,943,457,367,971,117,744],function(){return e(e.s=8953)}),_N_E=e.O()}]);