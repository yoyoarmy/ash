(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[881],{8221:function(e,a,t){Promise.resolve().then(t.bind(t,7991))},7991:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return y}});var s=t(7437),r=t(2265),l=t(605),i=t(9376),n=t(3541),d=t(9048),o=t(4935),c=t(1973);let u=(0,t(9763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var m=t(9478),x=t(2595),h=t(8930),v=t(7081);let p=e=>{if(!(null==e?void 0:e.name))return"bg-gray-100 text-gray-800";switch(e.name){case"Recibido":return"bg-red-100 text-red-800";case"Asignado":return"bg-orange-100 text-orange-800";case"Encendido":return"bg-amber-100 text-amber-800";case"Evidencia Enviada":return"bg-yellow-100 text-yellow-800";case"Reporte Enviado":return"bg-lime-100 text-lime-800";case"Facturado":return"bg-emerald-100 text-emerald-800";case"Completado":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};function y(){let{data:e}=(0,l.useSession)(),a=(0,i.useRouter)(),[t,y]=(0,r.useState)([]),[g,f]=(0,r.useState)(!0),[j,N]=(0,r.useState)(""),[b,w]=(0,r.useState)(null),[E,S]=(0,r.useState)(null),[k,M]=(0,r.useState)(null),{addNotification:C}=(0,v.z)();(0,r.useEffect)(()=>{var t;if((null==e?void 0:null===(t=e.user)||void 0===t?void 0:t.role)==="ADVERTISER"){a.replace("/leasing/my-leases");return}let s=async()=>{if(null==e?void 0:e.user)try{let e=await fetch("/api/orders");if(!e.ok)throw Error("Failed to fetch orders");let a=await e.json();y(a)}catch(e){console.error("Error fetching orders:",e)}finally{f(!1)}};(null==e?void 0:e.user)&&s()},[e,a]);let Z=t.filter(e=>{let a=j.toLowerCase();return!!e.id.toString().includes(a)||e.leases.some(e=>e.id.toString().includes(a)||e.customerName.toLowerCase().includes(a)||e.mediaSpace.store.name.toLowerCase().includes(a)||e.mediaSpace.mediaItem.type.toLowerCase().includes(a))}),A=async e=>{if(confirm("\xbfEst\xe1 seguro de que desea eliminar esta solicitud?")){M(e);try{if(!(await fetch("/api/orders/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete order");let a=t.filter(a=>a.id!==e);y(a),C("Solicitud eliminada exitosamente")}catch(e){console.error("Error deleting order:",e),C("Error al eliminar la solicitud")}finally{M(null)}}},D=async e=>{try{let a=await fetch("/api/leases/".concat(e));if(!a.ok)throw Error("Failed to fetch lease details");let t=await a.json();w(t)}catch(e){console.error("Error fetching lease details:",e),C("Error al cargar los detalles del arriendo")}};return g?(0,s.jsx)(o.p,{}):(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Historial de Solicitudes"}),(0,s.jsxs)("div",{className:"relative mb-6",children:[(0,s.jsx)(u,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,s.jsx)(c.I,{type:"text",placeholder:"Buscar por #orden, #lease, cliente, tienda o tipo de medio...",value:j,onChange:e=>N(e.target.value),className:"pl-10 w-full max-w-xl"})]}),0===Z.length?(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6 text-center text-gray-500",children:j?"No se encontraron resultados":"No hay solicitudes para mostrar"}):(0,s.jsx)("div",{className:"space-y-6",children:Z.map(e=>{let a=e.leases.reduce((e,a)=>e+a.amount,0);return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold",children:["Numero de Orden #",e.id]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Fecha de Creaci\xf3n:",(0,n.Z)(new Date(e.createdAt),"dd MMM yyyy, HH:mm",{locale:d.Z})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("span",{className:"text-lg font-semibold",children:["$",a.toLocaleString()]}),(0,s.jsx)(x.z,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>A(e.id),disabled:k===e.id,children:k===e.id?(0,s.jsx)("span",{className:"loading loading-spinner loading-sm"}):(0,s.jsx)(h.Z,{className:"h-4 w-4"})})]})]}),(0,s.jsx)("div",{className:"space-y-4",children:e.leases.map(a=>{var t,r,l,i,o,c,u,m,x,h,v;return(0,s.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:async()=>{await D(a.id),S(e)},children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium",children:a.customerName}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[null!==(h=null===(r=a.mediaSpace)||void 0===r?void 0:null===(t=r.store)||void 0===t?void 0:t.name)&&void 0!==h?h:"Store N/A"," - ",null!==(v=null===(i=a.mediaSpace)||void 0===i?void 0:null===(l=i.mediaItem)||void 0===l?void 0:l.type)&&void 0!==v?v:"Type N/A"]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:(null===(o=a.extraInformation)||void 0===o?void 0:o.planAlaMedida)?(0,s.jsxs)("span",{className:"text-gray-600",children:["Plan a la Medida URL: ",a.extraInformation.planAlaMedida]}):null===(u=a.mediaSpace)||void 0===u?void 0:null===(c=u.mediaItem)||void 0===c?void 0:c.dimensions}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,n.Z)(new Date(a.startDate),"d MMM",{locale:d.Z})," - ",(0,n.Z)(new Date(a.endDate),"d MMM yyyy",{locale:d.Z})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("span",{className:"inline-block px-2 py-1 rounded text-sm font-medium ".concat(p(a.status)),children:(null===(m=a.status)||void 0===m?void 0:m.name)||"Estado Desconocido"}),(0,s.jsxs)("p",{className:"text-sm font-medium mt-1",children:["$",((null===(x=a.extraInformation)||void 0===x?void 0:x.planAlaMedidaAmount)||a.amount).toLocaleString()]})]})]})},a.id)})})]},e.id)})}),(0,s.jsx)(m.i,{lease:b,orders:E,isOpen:!!b,onClose:()=>w(null)})]})}},8930:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(9763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[554,605,541,992,347,534,971,117,744],function(){return e(e.s=8221)}),_N_E=e.O()}]);