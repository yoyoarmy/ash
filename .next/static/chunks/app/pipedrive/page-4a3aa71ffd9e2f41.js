(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[728],{7995:function(e,a,t){Promise.resolve().then(t.bind(t,8234))},2443:function(e,a,t){"use strict";t.d(a,{p:function(){return l}});var s=t(7437),r=t(605),i=t(9376),n=t(4935);function l(e){let{children:a,allowedRoles:t}=e,{data:l,status:c}=(0,r.useSession)();return"loading"===c?(0,s.jsx)(n.p,{}):((null==l?void 0:l.user)&&t.includes(l.user.role)||(0,i.redirect)("/leasing"),(0,s.jsx)(s.Fragment,{children:a}))}},4029:function(e,a,t){"use strict";t.d(a,{Ol:function(){return l},Zb:function(){return n},aY:function(){return d},ll:function(){return c}});var s=t(7437),r=t(2265),i=t(4508);let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});n.displayName="Card";let l=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...r})});l.displayName="CardHeader";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("h3",{ref:a,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});c.displayName="CardTitle";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,i.cn)("p-6 pt-0",t),...r})});d.displayName="CardContent"},6393:function(e,a,t){"use strict";t.d(a,{_:function(){return n}});var s=t(7437),r=t(2265),i=t(4508);let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("label",{ref:a,className:(0,i.cn)("text-sm font-medium leading-none",t),...r})});n.displayName="Label"},8234:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return g}});var s=t(7437),r=t(2265),i=t(4029),n=t(4935),l=t(3541),c=t(2443),d=t(2595),o=t(9478),h=t(8728);let u=(0,t(9763).Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var f=t(2451),x=t(407),m=t(3805),p=t(1973),y=t(6393),j=t(7081);function g(){let[e,a]=(0,r.useState)([]),[t,g]=(0,r.useState)([]),[v,N]=(0,r.useState)(!0),[w,b]=(0,r.useState)(null),[C,k]=(0,r.useState)(null),[S,E]=(0,r.useState)(!1),[z,A]=(0,r.useState)(""),[Z,O]=(0,r.useState)(""),{addNotification:I}=(0,j.z)(),[P,T]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([fetch("/api/statuses"),fetch("/api/leases")]),s=await e.json(),r=await t.json();a(Array.isArray(s)?s:[]),g(Array.isArray(r)?r:[])}catch(e){console.error("Error fetching data:",e),a([]),g([])}finally{N(!1)}})()},[]);let _=async(a,t,s)=>{let r=e.findIndex(e=>e.id===t);if(-1===r)return;let i="next"===s?r+1:r-1;if(i<0||i>=e.length)return;let n=e[i].id;b(a);try{if(!(await fetch("/api/leases/".concat(a,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({statusId:n})})).ok)throw Error("Failed to update status");await M()}catch(e){console.error("Error updating lease status:",e),await M()}finally{b(null),await M()}},M=async()=>{N(!0);try{let[e,t]=await Promise.all([fetch("/api/statuses"),fetch("/api/leases")]),s=await e.json(),r=await t.json();a(Array.isArray(s)?s:[]),g(Array.isArray(r)?r:[])}catch(e){console.error("Error fetching data:",e),a([]),g([])}finally{N(!1)}},R=async()=>{try{let e=await fetch("/api/notification-settings");(await e.json()).forEach(e=>{2===e.brandId&&A(e.email),3===e.brandId&&O(e.email)})}catch(e){console.error("Error loading settings:",e)}},D=async()=>{T(!0);try{if(z&&!(await fetch("/api/notification-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({brandId:2,email:z})})).ok)throw Error("Failed to save Novey settings");if(Z&&!(await fetch("/api/notification-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({brandId:3,email:Z})})).ok)throw Error("Failed to save Cochez settings");I("Configuraci\xf3n guardada exitosamente"),E(!1)}catch(e){console.error("Error saving settings:",e),I("Error al guardar la configuraci\xf3n")}finally{T(!1)}},F=async e=>{try{if(!(await fetch("/api/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})})).ok)throw Error("Failed to send test email");I("Email de prueba enviado correctamente")}catch(e){console.error("Error sending test email:",e),I("Error al enviar email de prueba")}};return((0,r.useEffect)(()=>{R()},[]),v)?(0,s.jsx)(n.p,{}):(0,s.jsx)(c.p,{allowedRoles:["ADMIN","ASSOCIATE"],children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Pipeline de Solicitudes"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.z,{onClick:M,disabled:v,children:"Actualizar"}),(0,s.jsx)(d.z,{variant:"ghost",size:"icon",onClick:()=>E(!0),className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)(h.Z,{className:"h-5 w-5"})})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto pb-4",children:(0,s.jsx)("div",{className:"flex gap-4 min-w-max",children:Array.isArray(e)&&e.filter(e=>7!==e.id).map((a,r)=>(0,s.jsxs)("div",{className:"bg-gray-100 rounded-lg p-4 w-[300px]",children:[(0,s.jsx)("h2",{className:"font-semibold mb-4",children:a.name}),(0,s.jsx)("div",{className:"space-y-2",children:Array.isArray(t)&&t.filter(e=>e.statusId===a.id).map(t=>(0,s.jsxs)(i.Zb,{className:"p-2 bg-white shadow-sm hover:shadow-md transition-shadow relative ".concat(w===t.id?"opacity-50":""),children:[w===t.id&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-50",children:(0,s.jsx)(n.p,{})}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium truncate",children:t.customerName}),(0,s.jsxs)("div",{className:"flex items-center text-xs text-gray-600 gap-1 truncate",children:[(0,s.jsx)("span",{className:"truncate max-w-[120px]",children:t.mediaSpace.store.name}),(0,s.jsx)("span",{className:"flex-shrink-0",children:"â€¢"}),(0,s.jsx)("span",{className:"truncate",children:t.mediaSpace.mediaItem.type})]})]}),(0,s.jsx)("button",{onClick:()=>k(t),className:"p-1 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100 flex-shrink-0",children:(0,s.jsx)(u,{size:16})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2 pt-2 border-t",children:[(0,s.jsxs)("span",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:[(0,l.Z)(new Date(t.startDate),"dd/MM/yy")," - ",(0,l.Z)(new Date(t.endDate),"dd/MM/yy")]}),(0,s.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>_(t.id,a.id,"prev"),disabled:0===r||w===t.id,className:"px-1.5 py-0.5 h-auto",children:(0,s.jsx)(f.Z,{size:14})}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>_(t.id,a.id,"next"),disabled:r===e.length-1||w===t.id,className:"px-1.5 py-0.5 h-auto",children:(0,s.jsx)(x.Z,{size:14})})]})]})]})]},t.id))})]},a.id))})}),(0,s.jsx)(o.i,{lease:C,isOpen:!!C,onClose:()=>k(null)}),(0,s.jsx)(m.Vq,{open:S,onOpenChange:E,children:(0,s.jsxs)(m.cZ,{children:[(0,s.jsx)(m.fK,{children:(0,s.jsx)(m.$N,{children:"Configuraci\xf3n de Notificaciones"})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(y._,{children:"Email para Novey"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(p.I,{type:"email",placeholder:"ejemplo@novey.com",value:z,onChange:e=>A(e.target.value)}),(0,s.jsx)(d.z,{variant:"outline",onClick:()=>F(z),disabled:!z,children:"Probar"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(y._,{children:"Email para Cochez"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(p.I,{type:"email",placeholder:"ejemplo@cochez.com",value:Z,onChange:e=>O(e.target.value)}),(0,s.jsx)(d.z,{variant:"outline",onClick:()=>F(Z),disabled:!Z,children:"Probar"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(d.z,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),(0,s.jsx)(d.z,{onClick:D,disabled:P,children:P?"Guardando...":"Guardar"})]})]})]})})]})})}},2451:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(9763).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},407:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(9763).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},8728:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(9763).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])}},function(e){e.O(0,[554,605,541,992,347,534,971,117,744],function(){return e(e.s=7995)}),_N_E=e.O()}]);