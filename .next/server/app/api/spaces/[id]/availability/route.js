"use strict";(()=>{var e={};e.id=751,e.ids=[751],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},94461:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>u});var i={};t.r(i),t.d(i,{GET:()=>p});var s=t(49303),r=t(88716),n=t(60670),o=t(72331),l=t(87070);async function p(e,{params:a}){try{let e=parseInt(a.id),t=await o._.mediaSpace.findUnique({where:{id:e},include:{mediaItem:!0,leases:{where:{AND:[{status:{name:{not:"Completado"}}},{endDate:{gte:new Date}}]}}}});if(!t)return l.NextResponse.json({error:"Media space not found"},{status:404});console.log("Media Space Details:",{id:t.id,capacity:t.mediaItem.capacity,activeLeases:t.leases.length});let i=new Map,s=new Date;new Date().setFullYear(s.getFullYear()+1),t.leases.forEach(e=>{let a=new Date(e.startDate),t=new Date(e.endDate);for(let e=new Date(a);e<=t;e.setDate(e.getDate()+1)){let a=e.toISOString().split("T")[0],t=i.get(a)||0;i.set(a,t+1)}});let r=Array.from(i.entries()).map(([e,a])=>({date:e,activeLeases:a,remainingCapacity:t.mediaItem.capacity-a,isAtCapacity:a>=t.mediaItem.capacity}));return console.log("Date Capacities Sample:",r.slice(0,5)),l.NextResponse.json({capacity:t.mediaItem.capacity,dateCapacities:r,totalLeases:t.leases.length})}catch(e){return console.error("Error fetching availability:",e),l.NextResponse.json({error:"Failed to fetch availability"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/spaces/[id]/availability/route",pathname:"/api/spaces/[id]/availability",filename:"route",bundlePath:"app/api/spaces/[id]/availability/route"},resolvedPagePath:"/Users/yoyo/Desktop/adspace 2/app/api/spaces/[id]/availability/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:u,serverHooks:m}=c,y="/api/spaces/[id]/availability/route";function g(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:u})}},72331:(e,a,t)=>{t.d(a,{_:()=>s});var i=t(53524);let s=globalThis.prisma??new i.PrismaClient({log:["query"]})}};var a=require("../../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),i=a.X(0,[8948,5972],()=>t(94461));module.exports=i})();